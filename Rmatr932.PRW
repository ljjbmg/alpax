#INCLUDE "Protheus.ch"
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥Matr932      ≥Autor≥ Juan Jose Pereira    ≥ Data ≥ 06.01.97   ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥Imprime Registro de Entradas P1A e Saidas P2A                 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥ ATUALIZACOES SOFRIDAS DESDE A CONSTRUCAO INICIAL.                       ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥ PROGRAMADOR  ≥ DATA   ≥ BOPS ≥  MOTIVO DA ALTERACAO                     ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥ Marcos Simidu≥26/11/97≥XXXXXX≥Impressao de itens com Tes do livro ='Z'  ≥±±
±±≥ Marcos Simidu≥27/11/97≥13677A≥Correcao de salto de pagina.              ≥±±
±±≥ Marcos Simidu≥23/12/97≥13855A≥Correcao nas totalizacoes mes/periodos.   ≥±±
±±≥ Marcos Simidu≥11/02/98≥XXXXXX≥Compatibilizacao com Emissor Cupom Fiscal ≥±±
±±≥ Marcos Simidu≥24/03/98≥14621A≥Inclusao parametro Totaliza por dia.      ≥±±
±±≥ Rodrigo Sart.≥25/03/98≥10385A≥Alteracao do parametro mv_par04  Lista:   ≥±±
±±≥              ≥        ≥      ≥(1)Livros (2)Termos (3)Livros e Termos    ≥±±
±±≥ Rodrigo Sart.≥27/03/98≥14810A≥ Tratamento do estado origem no Resumo    ≥±±
±±≥              ≥        ≥14810A≥ variavel (lLisEstOri).                   ≥±±
±±≥ Marcos Simidu≥02/04/98≥15022A≥Impressao de Termo Encerr. quando o perio-≥±±
±±≥              ≥        ≥15022A≥do informado nao possuir movimento.       ≥±±
±±≥ Marcos Simidu≥06/05/98≥XXXXXX≥Acertos na impressao do termo de encerra- ≥±±
±±≥              ≥        ≥      ≥mento do livro de saidas.                 ≥±±
±±≥ Marcos Simidu≥11/08/98≥XXXXXX≥Zerar array acumulador dos resumos.       ≥±±
±±≥ Marcos Simidu≥22/10/98≥18419A≥Acertos no param.consid.UF no demonst.    ≥±±
±±≥              ≥22/10/98≥18419A≥por estado de origem.                     ≥±±
±±≥ Marcos Simidu≥03/11/98≥XXXXXX≥Acertos no ano com 4 bytes.               ≥±±
±±≥ Andreia      ≥29/01/99≥xxxxxx≥Alteracao do lay-out devido ao aumento do ≥±±
±±≥              ≥        ≥      ≥campo conta contabil.  	                ≥±±
±±≥ Andreia      ≥11/03/99≥xxxxxx≥Tratamento da especie das notas fiscais   ≥±±
±±≥              ≥        ≥      ≥canceladas atraves do parametro MV_ESPECIE≥±±
±±≥ Andreia      ≥04/08/99≥22553A≥Tratamento do parametro MV_PAR21 que defi-≥±±
±±≥              ≥        ≥      ≥ne em qual coluna sera impresso o imposto ≥±±
±±≥              ≥        ≥      ≥retido.                                  	≥±±
±±≥ Andreia      ≥05/11/99≥24340A≥Troca de CGC por CNPJ.                    ≥±±
±±≥ Andreia      ≥14/12/99≥19277A≥No resumo por CFOP,trocar TOTAL por SUB-TOTAL≥±±
±±≥              ≥        ≥      ≥e TOTAL GERAL por TOTAL(Portaria CAT 08/90).≥±±
±±≥ Guilherme    ≥06/07/07≥125854≥Inclusao do numero da Reducao Z para os   ≥±±
±±≥ Santos       ≥        ≥      ≥movimentos gerados para ECF's.            ≥±±
±±≥ Danilo       ≥12/09/07≥131472≥Passado como parametro no EmiteLivro, uma ≥±±
±±≥ Calil        ≥        ≥      ≥string indicando quem esta executando.    ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
User FUNCTION RMatr932()

Local cArqCiap		:= ""
LOCAL nSvApurICM 	:= 0
LOCAL nSvApurIPI 	:= 0
Private cIndxSF3  	:=""
Private nCredAtivo	:=0
                          
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Flag de Movimentacao            ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
lHouveMov:=.F.
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Largura do campo de observacoes ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
nLargObs:=If(nTipoMov=1,42,46)
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Pictures de campos numericos ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
cPictVl:=If(nTipoMov==1,"@E 999,999,999,999.99","@E 999,999,999,999.99")	// Colunas Valores
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Recebe layout do modelo escolhido ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
aL:=NIL
R932LayOut()
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ So trata arquivo quando for imprimir Livros ou Livros e Termos≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If nImpTerm == 1 .Or. nImpTerm == 3
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Cria Arquivo a ser Impresso com um indice de mesmo nome            ≥
	//≥ Ordem (1) = F3_FILIAL+DTOS(F3_ENTRADA)+F3_SERIE+F3_NFISCAL+F3_CFO  ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	cArqTemp  :=EmiteLivro(If(nTipoMov==1,"E","S"),dDtIni,dDtFim,lLacuna,lServico,lDesconto,cNrLivro,cFilterUser,@cArqCiap,MV_PAR27,MV_PAR09,MV_PAR31,MV_PAR32,MV_PAR33,MV_PAR36,"MATR930")
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Salva periodos de Apuracao ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	nSvApurICM:=DefPeriodo(F3_ENTRADA,nApurICM)
	nSvApurIPI:=DefPeriodo(F3_ENTRADA,nApurIPI)
EndIf
If !lAbortPrint
	If nTipoMov==1
		R932RegEntradas(nSvApurIcm,nSvApurIpi)
	Else
		R932RegSaidas(nSvApurIcm,nSvApurIpi)
	Endif
Endif
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Restaura area ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ So trata arquivo quando for imprimir Livros ou Livros e Termos≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If nImpTerm == 1 .Or. nImpTerm == 3
	dbSelectArea(cArqTemp)
	dbCloseArea()
	Ferase(cArqTemp+GetDbExtension())
	Ferase(cArqTemp+OrdBagExt())
EndIf
If ( Select("CIAP")!=0 )
	dbSelectArea("CIAP")
	dbCloseArea()
	Ferase(cArqCiap+GetDbExtension())
	Ferase(cArqCiap+OrdBagExt())
EndIf
If ( Select(cArqSF3)!=0 )
	dbSelectArea(cArqSF3)
	dbCloseArea()
	Ferase(cArqSF3+GetDbExtension())
	Ferase(cIndxSF3+OrdBagExt())
EndIf
dbSelectArea(aSvArea[1])
dbSetOrder(aSvArea[2])
dbGoto(aSvArea[3])
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo   ≥R932RegEntradas≥Autor≥Juan Jose Pereira    ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo≥Imprime Registro de Entradas                                 ≥±±
±±¿ƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932RegEntradas(nSvApurIcm,nSvApurIpi)

Local nTotICMS	:= 0

Local aProdutor	:= {}
Local dDataProd	:= cToD("  /  /  ")
Local lApur 	:= .F.
Local aAreaSM0	:= SM0->(GetArea())
Local lCredST	:= SF3->(FieldPos("F3_CREDST")) > 0
Local lProcST	:= .T.

aGrade			:= NIL

//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ So trata arquivo quando for imprimir Livros ou Livros e Termos≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If nImpTerm == 1 .Or. nImpTerm == 3
	dbSelectArea(cArqTemp)
	dDiaAnt:=F3_ENTRADA
	dDia:=dDiaAnt
	SetRegua(LastRec())
	While !Eof()
		lTotGrade:=.F.
		IncRegua()
		If Interrupcao(@lAbortPrint)
			Exit
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Considera filtro do usuario                     ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
        If !(cArqTemp)->SEMMOV
		   If !Empty(cFilterUser).and.!(&cFilterUser)
			  dbSkip()
			  Loop
		   EndIf
		Endif
		
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Verifica o valor do ICMS Retido de acordo com a configuracao da TES     ≥
		//≥Quando o campo F3_CREST existir e estiver configurado como "4",         ≥
		//≥o valor do ICMS retido nao deve ser apresentado na coluna de observacoes≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		lProcST := .T.
		If lCredST
			If (cArqTemp)->F3_CREDST == "4"
		       	lProcST := .F.
			Endif
		Endif
		   
		//⁄ƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cabecalho ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒŸ
		If nLin>nLimPag .And. !(cArqTemp)->SEMMOV
			R932Cabec(dDia)
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Contador de Tamanho de nota ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		nTamNota:=nLin
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Imprime os periodos sem movimento≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If (cArqTemp)->SEMMOV
			dDia:=(cArqTemp)->F3_ENTRADA
			R932Cabec(dDia)
			cLinha:=FmtLin(Array(16),aL[17],,,nLin,.F.)
			R93xFillPage(cLinha,"*** NAO HOUVE MOVIMENTO ***",@nLin,nLimPag) //
			FmtLin(,aL[1],,,@nLin)
			R932TermEnc()
			(cArqTemp)->(dbSkip())     
			dDia:=(cArqTemp)->F3_ENTRADA          
			lHouveMov := .T.
			Loop     
		Endif    

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Salva o perÌodo de apuraÁ„o≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !lApur
			lApur := .T.
			nSvApurICM:=DefPeriodo(F3_ENTRADA,nApurICM)
			nSvApurIPI:=DefPeriodo(F3_ENTRADA,nApurIPI)
		Endif                         
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Posiciona na filial em que foi processado o registro	≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
        Mtr930Fil(aAreaSM0,(cArqTemp)->FILCORR,1)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Conta contabil devera ser buscada no parametro MV_CTALFE de cada filial≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		cContaContab := Alltrim(GetMV("MV_CTALFE"))
		cContaContab :=	StrTran(cContaContab,"SF3->",)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Posiciona nos cadastros de Clientes/Fornecedores≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		cClieFor:=F3_CLIEFOR+F3_LOJA
		If(F3_TIPO$"DB",dbSelectArea("SA1"),dbSelectArea("SA2"))
		dbSeek(xFilial()+cClieFor)
		dbSelectArea(cArqTemp)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Restaura a filial e area corrente ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		Mtr930Fil(aAreaSM0,(cArqTemp)->FILCORR,2)
		//
		dbSelectArea(cArqTemp)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aObs:=LivrArrayObs(nLargObs,,lListaNFO)
		R932IniGrade()
		aGrade[1,2]:=F3_BASEICM
		aGrade[1,3]:=F3_VALICM
		aGrade[2,2]:=F3_ISENICM
		aGrade[3,2]:=F3_OUTRICM
		IF cMV_ESTADO != "SP" .OR. lCat21
			aGrade[4,2]:=F3_BASEIPI
			aGrade[4,3]:=F3_VALIPI
			aGrade[5,2]:=F3_ISENIPI
			aGrade[6,2]:=F3_OUTRIPI
        ENDIF
		aDados:=Array(16)
		aDados[1]:=DTOC(F3_ENTRADA)
		aDados[2] := IIf(Empty(F3_ESPECIE),R930CFOTra(F3_CFO,F3_SERIE),F3_ESPECIE)
		aDados[3]:=F3_SERIE
		aDados[4]:=F3_NFISCAL
		aDados[5]:=DTOC(F3_EMISSAO)
//		aDados[6]:=F3_CLIEFOR+"-"+F3_LOJA+Transform(iif(F3_TIPO$"BD",SA1->A1_CGC,SA2->A2_CGC),"@r 99.999.999/9999-99")
		aDados[6]:=Transform(iif(F3_TIPO$"BD",SA1->A1_CGC,SA2->A2_CGC),"@r 99.999.999/9999-99")
		aDados[7]:=F3_ESTADO
		aDados[8]:=F3_VALCONT
		aDados[9]:=EvalMacro(cContaContabil)
		aDados[10]:=If(substr(F3_CFO,1,3)$"999#000",,Transform(F3_CFO,PESQPICT("SF3","F3_CFO"))) 
		If nModelo != 5
			aDados[14]:=Iif(F3_ALIQICM > 0,Transform(F3_ALIQICM,"@E 99.99"),"")
		EndIf
		nTotICMS += F3_VALICM
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Linhas de detalhe              ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		R932ImpGrade()
		// Adicionado por Adriano para imprimir mais uma linha por titulo com o nome do cliente/fornecedor.
		If F3_TIPO$"BD"
			aDados[6] := Left(SA1->A1_NOME,22)
		Else
			aDados[6] := Left(SA2->A2_NOME,22)
		EndIf                                 
		 
		FmtLin(@aDados,aL[17],cPictVl,,@nLin)		

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[17],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Para atender legislacao Fomentar de GO ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and.F3_ICMSRET-F3_OBSSOL>0  .And. lProcST
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=F3_BASERET
			If nColuna ==1
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(F3_ICMSRET-F3_OBSSOL,PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[15]:=F3_ICMSRET-F3_OBSSOL
			ElseIf nColuna == 3
				If F3_TIPO == "D"
					aDados[15]:=F3_ICMSRET-F3_OBSSOL
				Else
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(F3_ICMSRET-F3_OBSSOL,PESQPICT("SF3","F3_ICMSRET"))) //
				Endif
			EndIf
			FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		Elseif nColuna ==2 .and. F3_ICMSRET-F3_OBSSOL>0  .And. lProcST
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=F3_BASERET 
			If nModelo != 5
				aDados[14]:=Iif(F3_ALIQICM > 0,Transform(F3_ALIQICM,"@E 99.99"),"")
			EndIf
			aDados[15]:=F3_ICMSRET-F3_OBSSOL
			FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		Elseif nColuna ==3 .and.F3_ICMSRET-F3_OBSSOL>0  .And. lProcST
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=F3_BASERET
			If F3_TIPO == "D"
				aDados[15]:=F3_ICMSRET-F3_OBSSOL
			Else
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(F3_ICMSRET-F3_OBSSOL,PESQPICT("SF3","F3_ICMSRET"))) //
			Endif
			FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		Endif
		
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Acumula valores ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		nLinNec:=nLin-nTamNota+If(lImpZer,3,0)
		aTamNotas[1]:=Max(aTamNotas[1],nLinNec)
		LivrAcumula(cArqTemp,@aTotDia,@aTotPerICM,@aTotPerIPI,@aTotMes,@aTransp,@aResumo,@aResCFO,cArqSF3)
		dDiaAnt:=F3_ENTRADA
		********************* CIAP **********************
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Atualiza a Manutencao do CIAP                   ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If lEmiteCiap
			If Select("CIAP") > 0
				dbSelectArea("CIAP")
				If ( dbSeek(&(cArqTemp)->(Recno())) )
					While ( !Eof() .And. CIAP->SF3==&(cArqTemp)->(Recno()) )
						dbSelectArea("SF9")
						dbGoto(CIAP->SF9)
						Begin Transaction
							RecLock("SF9",.F.)
							SF9->F9_NLRE := Val(cLivro)
							SF9->F9_FLRE := nPagina
							MsUnlock()
						End Transaction
						dbSelectArea("CIAP")
						dbSkip()
					EndDo
				Endif
			EndIf
		Endif
		********************* CIAP **********************
		dbSelectArea(cArqTemp)
		dDataProd 	:= F3_ENTRADA		
		nMes 		:= Month(F3_ENTRADA)
		dbSkip()
		If !Eof()
			dDia:=F3_ENTRADA
		Else
			dDia:=UltimoDia(dDia)+1
		EndIf
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Totais e finaliza relatorio ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		lTotGrade:=.T.
		lHouveMov:=.T.
		R932Totais(@nSvApurIcm,@nSvApurIpi)
	
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Imprime quadro de demonstrativo de Produtor Rural≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If lProdutor .And. nModelo == 2 .And. Month(F3_ENTRADA) <> nMes
			nMes := Month(F3_ENTRADA)
			aProdutor := {}
			aProdutor := Mtr930Apur(nApurICM,Year(dDataProd),Month(dDataProd),cNrLivro)
			If Len(aProdutor) > 0
				R932Cabec(dDataProd,.F.)
				FmtLin(,aL[20],,,@nLin)
				FmtLin(,aL[21],,,@nLin)
				FmtLin(,aL[22],,,@nLin)
				FmtLin({aProdutor[01][02]},aL[23],,,@nLin)
				FmtLin(,aL[24],,,@nLin)
				FmtLin({nTotICMS},aL[25],,,@nLin)
				FmtLin(,aL[26],,,@nLin)
				FmtLin({aProdutor[01][03]+aProdutor[01][04]},aL[27],,,@nLin)
				FmtLin(,aL[28],,,@nLin)
				FmtLin({aProdutor[01][01]},aL[29],,,@nLin)
				FmtLin(,aL[30],,,@nLin)
				FmtLin(,aL[31],,,@nLin)
				FmtLin({(aProdutor[01][02]+nTotICMS)-(aProdutor[01][03]+aProdutor[01][01]+aProdutor[01][04])},aL[32],,,@nLin)
				FmtLin(,aL[33],,,@nLin)
				FmtLin(,aL[34],,,@nLin)
				nLin := 80
			Endif
	
		Endif
	End
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Quando nao ha movimento                                      ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	If !lHouveMov
		dDia:=dDtIni
		R932Cabec(dDia)
		cLinha:=FmtLin(Array(16),aL[17],,,nLin,.F.)
		R93xFillPage(cLinha,"*** NAO HOUVE MOVIMENTO ***",@nLin,nLimPag) //
		FmtLin(,aL[1],,,@nLin)
		R932TermEnc()
	Endif
Else
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Imprime Termo de Abertura    ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932TermIni()
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Imprime Termo de Encerramento≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932TermEnc()
EndIf
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo   ≥R932RegSaidas≥Autor≥ Juan Jose Pereira     ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo≥Imprime Registro de Saidas                                   ≥±±
±±¿ƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932RegSaidas(nSvApurIcm,nSvApurIpi)
Local lMV_ESTCLI 	:= GetNewPar ("MV_ESTCLI", .F.)	//Parametro para mudar a pesquisa do estado do cliente. F3_ESTADO pelo A1_EST ou A2_EST.
Local lEcfNotas 	:= GetNewPar ("MV_ECFNOTA", .F.)	//Parametro tem como objetivo imprimir o documento final mesmo sem a utilizacao de Aglutinar Notas Fiscais de Saida
Local lApur			:= .F.
Local aAreaSM0 		:= SM0->(GetArea())
Local lCredST		:= SF3->(FieldPos("F3_CREDST")) > 0
Local lProcST		:= .T.
Local lImpSemMov	:= .F.
Local lImpTot		:= .F.
PRIVATE aGrade:={}                                 


//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ So trata arquivo quando for imprimir Livros ou Livros e Termos≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If nImpTerm == 1 .Or. nImpTerm == 3
	dbSelectArea(cArqTemp)
	dDiaAnt:=F3_ENTRADA
	dDia:=dDiaAnt
	SetRegua(LastRec())
	While !Eof()
		IncRegua()
		If Interrupcao(@lAbortPrint)
			Exit
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Considera filtro do usuario                     ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
        If !(cArqTemp)->SEMMOV
		   If !Empty(cFilterUser).and.!(&cFilterUser)
			  dbSkip()
			  Loop
		   EndIf
		Endif   
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Verifica o valor do ICMS Retido de acordo com a configuracao da TES     ≥
		//≥Quando o campo F3_CREST existir e estiver configurado como "4",         ≥
		//≥o valor do ICMS retido nao deve ser apresentado na coluna de observacoes≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		lProcST := .T.
		If lCredST
			If (cArqTemp)->F3_CREDST == "4"
		       	lProcST := .F.
			Endif
		Endif
		If (!lLacuna .AND. !Empty(F3_DTCANC))
			dbSelectArea(cArqTemp)
			dbSkip()
			If lHouveMov
				dDia:=F3_ENTRADA
			EndIf
			lImpTot := .F.
			loop
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cabecalho ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒŸ
		If nLin>nLimPag .And. !(cArqTemp)->SEMMOV
			R932Cabec(dDia)
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Imprime os periodos sem movimento≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If (cArqTemp)->SEMMOV
			dDia:=(cArqTemp)->F3_ENTRADA
			R932Cabec(dDia)
			cLinha:=FmtLin(Array(14),aL[19],,,nLin,.F.)
			R93xFillPage(cLinha,"*** NAO HOUVE MOVIMENTO ***",@nLin,nLimPag) //"*** NAO HOUVE MOVIMENTO ***"
			FmtLin(,aL[1],,,@nLin)
			R932TermEnc()
			(cArqTemp)->(dbSkip())     
			dDia:=(cArqTemp)->F3_ENTRADA          
			lHouveMov := .F.
			lImpSemMov:= .T.
			Loop     
		Endif

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Salva o perÌodo de apuraÁ„o≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !lApur
			lApur := .T.
			nSvApurICM:=DefPeriodo(F3_ENTRADA,nApurICM)
			nSvApurIPI:=DefPeriodo(F3_ENTRADA,nApurIPI)
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Posiciona na filial em que foi processado o registro	≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
        Mtr930Fil(aAreaSM0,(cArqTemp)->FILCORR,1)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Conta contabil devera ser buscada no parametro MV_CTALFS de cada filial≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		cContaContab := Alltrim(GetMV("MV_CTALFS"))
		cContaContab :=	StrTran(cContaContab,"SF3->",)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Verifica o parametro para cada filial processada≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
        lMV_ESTCLI 	:= GetNewPar ("MV_ESTCLI", .F.)	
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Posiciona nos cadastros de Clientes/Fornecedores ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		cClieFor:=F3_CLIEFOR+F3_LOJA
		If(F3_TIPO$"DB",dbSelectArea("SA2"),dbSelectArea("SA1"))
		dbSeek(xFilial()+cClieFor)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Restaura a filial e area corrente ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		Mtr930Fil(aAreaSM0,(cArqTemp)->FILCORR,2)
		//
		dbSelectArea(cArqTemp)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Contador de Tamanho de nota ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		nTamNota:=nLin
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aObs:=LivrArrayObs(nLargObs,,lListaNFO)
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Linhas de Detalhe≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aDados:=ARRAY(14)
		aDados[1] := IIf(Empty(F3_ESPECIE),If(F3_SERIE=="ECF","CF",R930CFOTra(F3_CFO,F3_SERIE)),F3_ESPECIE)

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Layout de acordo com a lei 9.513 (lista o intervalo de cupons fiscais - ECF)≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !lLeiECF .Or. Empty(F3_PDV)
			aDados[2]:=F3_SERIE
		Else
			aDados[2] := Alltrim(F3_PDV)
		Endif

		IF lAglutina
			aDados[3]:=F3_NFISCAL+" A "+IF(!EMPTY(F3_DTCANC),F3_NFISCAL,F3_DOCOR)	 	
		ELSE
			aDados[3]:=F3_NFISCAL+" A "+IF((F3_TIPO$"LC".Or.F3_SERIE=="ECF") .And. !lEcfNotas ,F3_DOCOR,F3_NFISCAL)
		ENDIF

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Layout de acordo com a lei 9.513 (lista o intervalo de cupons fiscais - ECF)≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If lLeiECF .AND. (SF3->(FieldPos("F3_NUMINI")) > 0 .AND. SF3->(FieldPos("F3_NUMFIM")) > 0) .AND. !Empty(F3_PDV)
			//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
			//≥Posiciona na filial em que foi processado o registro	≥
			//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	        Mtr930Fil(aAreaSM0,(cArqTemp)->FILCORR,1)

			//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
			//≥Recupera a partir do SFI, o numero do ultimo documento emitido no ECF.≥
			//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ

			dbSelectArea("SFI")
			dbSetOrder(1)		//FILIAL + DTMOVTO + PDV
			If DbSeek( xFilial("SFI") + DTOS( (cArqTemp)->F3_EMISSAO ) + (cArqTemp)->F3_PDV )
				aDados[3] := (cArqTemp)->F3_NUMINI + " A " + SFI->FI_COO
			EndIf
	
			dbSelectArea(cArqTemp)
			//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
			//≥Restaura a filial e area corrente ≥
			//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
			Mtr930Fil(aAreaSM0,(cArqTemp)->FILCORR,2)
		Endif

		aDados[4]:=StrZero(Day(F3_ENTRADA),2)
		//
		aDados[5]:=F3_ESTADO
		If (lMV_ESTCLI)
			aDados[5]:=Iif (F3_TIPO$"DB", SA2->A2_EST, SA1->A1_EST)
		EndIf
		//
		aDados[6]:=F3_VALCONT
		aDados[7]:=EvalMacro(cContaContabil)
		aDados[8]:=If(substr(F3_CFO,1,3)$"999#000",,Transform(F3_CFO,PESQPICT("SF3","F3_CFO")))
		aDados[9]:=F3_BASEICM        
		If nModelo != 5
			aDados[10]:=Iif(F3_ALIQICM > 0,Transform(F3_ALIQICM,"@E 99.99"),"")
		EndIf
		aDados[11]:=F3_VALICM
		aDados[12]:=F3_ISENICM
		aDados[13]:=F3_OUTRICM
		R932LoadObs()
		FmtLin(@aDados,aL[19],cPictVl,,@nLin)              
		
		// Adicionado por Adriano para imprimir mais uma linha por titulo com o nome do cliente/fornecedor.
		If ! F3_TIPO $ "DB"
			aDados[14] := Transform(SA1->A1_CGC,"@r 99.999.999/9999-99")+" "+Left(SA1->A1_NOME,22)
		Else
			aDados[14] := Transform(SA2->A2_CGC,"@r 99.999.999/9999-99")+" "+Left(SA2->A2_NOME,22)
		EndIf                                 
		 
		FmtLin(@aDados,aL[19],cPictVl,,@nLin)		
		
		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[19],cPictVl,,@nLin)
			Endif
		End


		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If ! Empty(cTitLivro) .And. F3_ICMSRET-F3_OBSSOL>0  .And. lProcST
			aDados[8]:="ST"
			aDados[9]:=F3_BASERET
			If nColuna ==1
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(F3_ICMSRET-F3_OBSSOL,PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[11]:=F3_ICMSRET-F3_OBSSOL
			ElseIf nColuna == 3
				If F3_TIPO == "D"
					aDados[11]:=F3_ICMSRET-F3_OBSSOL
				Else
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(F3_ICMSRET-F3_OBSSOL,PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			EndIF
			FmtLin(@aDados,aL[19],cPictVl,,@nLin)
		ElseIf nColuna ==2.and.F3_ICMSRET-F3_OBSSOL>0  .And. lProcST
			aDados[8]:="ST"
			aDados[9]:=F3_BASERET
			If nModelo != 5
				aDados[10]:=Iif(F3_ALIQICM > 0,Transform(F3_ALIQICM,"@E 99.99"),"")
			EndIf
			aDados[11]:=F3_ICMSRET-F3_OBSSOL
			FmtLin(@aDados,aL[19],cPictVl,,@nLin)
		ElseIf nColuna ==3.and.F3_ICMSRET-F3_OBSSOL>0  .And. lProcST
			aDados[8]:="ST"
			aDados[9]:=F3_BASERET
			If F3_TIPO == "D"
				aDados[11]:=F3_ICMSRET-F3_OBSSOL
			Else
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(F3_ICMSRET-F3_OBSSOL,PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[19],cPictVl,,@nLin)
		Endif
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Acumula valores ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		nLinNec:=nLin-nTamNota
		aTamNotas[1]:=Max(aTamNotas[1],nLinNec)
		LivrAcumula(cArqTemp,@aTotDia,@aTotPerICM,@aTotPerIPI,@aTotMes,@aTransp,@aResumo,@aResCFO,cArqSF3)
		dDiaAnt:=F3_ENTRADA
		dbSelectArea(cArqTemp)
		dbSkip()
		If !Eof()
			dDia:=F3_ENTRADA
		Else
			dDia:=UltimoDia(dDia)+1
		EndIf
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Totais e finaliza relatorio ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		lHouveMov	:= .T.
		lImpTot		:= .T.		
		R932Totais(@nSvApurIcm,@nSvApurIpi)
	End

	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Verifico se a ultima nota eh cancelada para imprimir o Total ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	If lHouveMov .And. 	!lImpTot
    	R932Totais(@nSvApurIcm,@nSvApurIpi)
	Endif
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Quando nao ha movimento                                      ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	If !lHouveMov .And. !lImpSemMov
		dDia:=dDtIni
		R932Cabec(dDia)
		cLinha:=FmtLin(Array(14),aL[19],,,nLin,.F.)
		R93xFillPage(cLinha,"*** NAO HOUVE MOVIMENTO ***",@nLin,nLimPag) //
		FmtLin(,aL[1],,,@nLin)
		R932TermEnc()
	Endif
Else
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Imprime Termo de Abertura    ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932TermIni()
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Imprime Termo de Encerramento≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932TermEnc()
EndIf
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932Cabec ≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Impressao de Cabecalho                                     ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932Cabec(dData,lImpDad)

Local lLFisOrd := GetNewPar("MV_LFISORD",.F.)

dData	:= IIf(dData==NIL,dDiaAnt,dData)
lImpDad := Iif(lImpDad==Nil,.T.,lImpDad)

cPeriodo:=aMeses[Month(dData)]+" / "+Str(Year(dData),4)
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Imprime Termos de Abertura/Encerramento≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
aPagTerm:=CtrlPg(@nPagina,nQtFeixe,lReiniPg)
cPagina :=Transform(StrZero(nPagina,6),"@R 999.999")
If (nImpTerm == 2 .Or. nImpTerm == 3) .and.aPagTerm[1]+aPagTerm[2]>0
	If nTipoMov==1
		ImprimeTermo(aPagTerm[1],nPagIni,nQtFeixe,GetMv("MV_LENTEN"),nLargMax,cPerg)
		nPagIni:=ImprimeTermo(aPagTerm[2],nPagIni,nQtFeixe,GetMv("MV_LENTAB"),nLargMax,cPerg)
	Else
		ImprimeTermo(aPagTerm[1],nPagIni,nQtFeixe,GetMv("MV_LSAIEN"),nLargMax,cPerg)
		nPagIni:=ImprimeTermo(aPagTerm[2],nPagIni,nQtFeixe,GetMv("MV_LSAIAB"),nLargMax,cPerg)
	Endif
Endif
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Imprime Cabecalho  ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
nLin:=3
FmtLin(,AvalImp(nLargMax),,,@nLin)
FmtLin(,aL[1],,,@nLin)
FmtLin({cTitLivro},aL[2],,,@nLin)
FmtLin(,aL[3],,,@nLin)
FmtLin({cNome},aL[4],,,@nLin)
FmtLin(,aL[5],,,@nLin)
FmtLin({cInscr,cCGC},aL[6],,,@nLin)
FmtLin(,aL[7],,,@nLin)
If !lLFisOrd
	FmtLin({cPagina,cPeriodo},aL[8],,,@nLin)	
Else
	FmtLin({cLivro,cPagina,cPeriodo},aL[8],,,@nLin)                                         
Endif
If lImpDad
	FmtLin(,{aL[9],aL[10],aL[11],aL[12],aL[13],aL[14],aL[15],aL[16]},,,@nLin)
	If nTipoMov==2
		FmtLin(,{aL[17],aL[18]},,,@nLin)
	Endif
Else                                                                             
	FmtLin(,{aL[9],aL[10],aL[11]},,,@nLin)
Endif
	
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932LayOut≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Layout dos modelos P1A e P2A                               ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932LayOut             

Local nSubDiv	:= mv_par36
Local lLFisOrd	:= GetNewPar("MV_LFISORD",.F.)
Local lImp  	:= GetNewPar("MV_IMPCABE",.F.)

If nTipoMov==1
	aL:=Array(34)
	aL[01]:="+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥Para atender a Legislacao de Pernambuco                        ≥
	//≥O valor do ICMS ST nas entradas deve ser apresentado em coluna ≥
	//≥especifica - Contribuinte Substituido - ICMS na Fonte          ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	If cMV_ESTADO == "PE"
		aL[02]:="|                                                                REGISTRO DE ENTRADAS #                                                               |                  (*) CODIGO DE VALORES FISCAIS                     |"
		aL[03]:="|                                                                                                                                                     |--------------------------------------------------------------------|"
		aL[04]:="| FIRMA: #############################                                                                                                                | 1  - OPERACOES COM CREDITO DO IMPOSTO                              |"
		aL[05]:="|                                                                                                                                                     | 2  - OPERACOES SEM CREDITO DO IMPOSTO - ISENTAS OU NAO TRIBUTADAS  |"
		aL[06]:="| INSC.EST: ###########           C.N.P.J.: ##############                                                                                            | 3  - OPERACOES SEM CREDITO DO IMPOSTO - OUTRAS                     |" 
		aL[07]:="|                                                                                                                                                     | ST - CONTRIBUINTE-SUBSTITUIDO - ICMS NA FONTE                      |"		
		aL[08]:="| FOLHA: #######                   MES OU PERIODO/ANO: #######                                                                                        |                                                                    |" 
		aL[09]:="|                                                                                                                                                     |                                                                    |"
		aL[10]:="|                                                                                                                                                     |                                                                    |"
	Else
		If nSubDiv == 1
			If lImp
				aL[02]:="|                                                                REGISTRO DE ENTRADAS # - P1A                                                         |                  (*) CODIGO DE VALORES FISCAIS                     |"
            Else
				aL[02]:="|                                                                REGISTRO DE ENTRADAS #                                                               |                  (*) CODIGO DE VALORES FISCAIS                     |"
            Endif
		ElseIf nSubDiv == 2
			If lImp
				aL[02]:= "|                                                        LIVRO REGISTRO DE ENTRADAS ESTADUAIS # - P1A                                                 |                  (*) CODIGO DE VALORES FISCAIS                     |"
			Else
				aL[02]:="|                                                        LIVRO REGISTRO DE ENTRADAS ESTADUAIS #                                                       |                  (*) CODIGO DE VALORES FISCAIS                     |"
		    Endif
		ElseIf nSubDiv == 3
			If lImp
				aL[02]:="|                                                      LIVRO REGISTRO DE ENTRADAS INTERESTADUAIS # - P1A                                              |                  (*) CODIGO DE VALORES FISCAIS                     |"
			Else
				aL[02]:="|                                                      LIVRO REGISTRO DE ENTRADAS INTERESTADUAIS #                                                    |                  (*) CODIGO DE VALORES FISCAIS                     |"
		    Endif
		Endif
		aL[03]:="|                                                                                                                                                     |--------------------------------------------------------------------|"
		aL[04]:="| FIRMA: #############################                                                                                                                |                                                                    |"
		aL[05]:="|                                                                                                                                                     | 1 - OPERACOES COM CREDITO DO IMPOSTO                               |"
		aL[06]:="| INSC.EST: ###########           C.N.P.J.: ##############                                                                                            |                                                                    |"
		aL[07]:="|                                                                                                                                                     | 2 - OPERACOES SEM CREDITO DO IMPOSTO - ISENTAS OU NAO TRIBUTADAS   |"
		If !lLFisOrd
			aL[08]:="| FOLHA: #######                   MES OU PERIODO/ANO: #######                                                                                        |                                                                    |"
		Else
			aL[08]:="| ORDEM/FOLHA: ###-E / #######     MES OU PERIODO/ANO: #######                                                                                                                                                             |"
		Endif
		aL[09]:="|                                                                                                                                                     | 3 - OPERACOES SEM CREDITO DO IMPOSTO - OUTRAS                      |"
		aL[10]:="|                                                                                                                                                     |                                                                    |"
	Endif
	aL[11]:="|==========================================================================================================================================================================================================================|"
	aL[12]:="|          |             DOCUMENTOS FISCAIS                                 |                  |      CODIFICACAO          |    |              VALORES FISCAIS                  |                                          |"
	aL[13]:="|          |----------------------------------------------------------------|                  |---------------------------|    |-----------------------------------------------|                                          |"
	aL[14]:="|DATA DE   |ESPE |  SERIE  |         |DATA      |CODIGO DO             | UF |                  |                    |      |ICMS|COD| BASE DE CALCULO  |     |      IMPOSTO     |                                          |"
	
	If ("SP"$cMV_ESTADO .OR. lCat21)
		aL[15]:="|ENTRADA   |CIE  |SUB-SERIE|NUMERO   |DOCUMENTO |EMITENTE              |ORIG|  VALOR CONTABIL  |    CONTABIL        |FISCAL|    |(*)|VALOR DA OPERACAO |ALIQ.|     CREDITADO    |                       OBSERVACOES        |"
	Else
		aL[15]:="|ENTRADA   |CIE  |SUB-SERIE|NUMERO   |DOCUMENTO |EMITENTE              |ORIG|  VALOR CONTABIL  |    CONTABIL        |FISCAL|IPI |(*)|VALOR DA OPERACAO |ALIQ.|     CREDITADO    |                       OBSERVACOES        |"
	EndIf
	
    aL[16]:="|==========|=====+=========+=========+==========+======================+====|==================|====================+======|====|===+==================+=====+==================|==========================================|"
	aL[17]:="|##########|#####|   ###   |#########|##########|######################| ## |##################|####################| #### |####| # |##################|#####|##################|##########################################|"
	aL[18]:="|# # # #   |# #########################################################| ## |##################|####################| #### |####| # |##################|#####|##################|##########################################|"
	aL[19]:="+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"
	aL[20]:="|                                                                                        DEMONSTRATIVO DE CREDITOS - PRODUTOR RURAL                                                                                        |" 
	aL[21]:="+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"
	aL[22]:="|                                                                                                                                                                                                                          |"
	aL[23]:="|                                                                      I   - SALDO CREDOR TRANSPORTADO DO MES ANTERIOR           ####################                                                                      |"
	aL[24]:="|                                                                                                                                                                                                                          |"	
	aL[25]:="|                                                                      II  - CREDITOS ESCRITURADOS NO MES                        ####################                                                                      |"
	aL[26]:="|                                                                                                                                                                                                                          |"
	aL[27]:="|                                                                      III - CREDITOS UTILIZADOS NO PERIODO                      ####################                                                                      |"
	aL[28]:="|                                                                                                                                                                                                                          |"
	aL[29]:="|                                                                      IV  - ESTORNOS DE CREDITOS EFETUADOS                      ####################                                                                      |" 
	aL[30]:="|                                                                                                                                                                                                                          |"
	aL[31]:="|                                                                                                                                                                                                                          |"
	aL[32]:="|                                                                      V   - SALDO DO PERIODO (I + II) - (III + IV)              ####################                                                                      |"
	aL[33]:="|                                                                                                                                                                                                                          |"
	aL[34]:="+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"
Else             
	aL:=Array(20)
	aL[01]:="+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"
	If nSubDiv == 1
		If lImp
			aL[02]:="|                                                                                                     REGISTRO DE SAIDAS # - P2A                                                                                           |"        
		Else
			aL[02]:="|                                                                                                     REGISTRO DE SAIDAS #                                                                                                 |"
	    Endif
	ElseIf nSubDiv == 2
		If lImp
			aL[02]:="|                                                                                             LIVRO REGISTRO DE SAIDAS ESTADUAIS # - P2A                                                                                   |"
		Else
			aL[02]:="|                                                                                             LIVRO REGISTRO DE SAIDAS ESTADUAIS #                                                                                         |"
	    Endif
	ElseIf nSubDiv == 3
		If lImp
			aL[02]:= "|                                                                                          LIVRO REGISTRO DE SAIDAS INTERESTADUAIS # - P2A                                                                                 |"
		Else
			aL[02]:="|                                                                                          LIVRO REGISTRO DE SAIDAS INTERESTADUAIS #                                                                                       |"
        Endif
	Endif
	aL[03]:="|                                                                                                                                                                                                                          |"
	aL[04]:="| FIRMA: #########################                                                                                                                                                                                         |"
	aL[05]:="|                                                                                                                                                                                                                          |"
	aL[06]:="| INSC.EST: #########             C.N.P.J.: ##############                                                                                                                                                                 |"
	aL[07]:="|                                                                                                                                                                                                                          |"
	If !lLFisOrd
		aL[08]:="| FOLHA: #######                   MES OU PERIODO/ANO: #######                                                                                                                                                             |"
	Else
		aL[08]:="| ORDEM/FOLHA: ###-E / #######     MES OU PERIODO/ANO: #######                                                                                                                                                             |"
	Endif
	aL[09]:="|                                                                                                                                                                                                                          |"
	aL[10]:="|                                                                                                                                                                                                                          |"
	aL[11]:="|==========================================================================================================================================================================================================================|"
	aL[12]:="|         DOCUMENTOS FISCAIS               |                  |      CODIFICACAO          |                                 VALORES FISCAIS                                 |                                              |"
	aL[13]:="|------------------------------------------|                  |---------------------------|---------------------------------------------------------------------------------|                                              |"
	aL[14]:="|     |     |                     |   |    |                  |                    |      |      OPERACOES COM DEBITO DO IMPOSTO      |   OPERACOES SEM DEBITO DO IMPOSTO   |                                              |"
	aL[15]:="|     |SERIE|                     |   |    |                  |                    |      |-------------------------------------------|-------------------------------------|                                              |"
	aL[16]:="|ESPE | SUB-|                     |   | UF |      VALOR       |                    |      |     BASE DE      |     |     IMPOSTO      |    ISENTAS OU    |                  |                                              |"
	aL[17]:="|CIE  |SERIE|    NUMERO           |DIA|DEST|     CONTABIL     |   CONTABIL         |FISCAL|     CALCULO      |ALIQ |     DEBITADO     |  NAO TRIBUTADAS  |      OUTRAS      |             OBSERVACOES                      |"
	aL[18]:="|=====+=====+=====================+===+====|==================|====================+======|==================+=====+==================|==================+==================|==============================================|"
	aL[19]:="|#####|#####|#####################| ##| ## |##################|####################| #### |##################|#####|##################|##################|##################|##############################################|"
	aL[20]:="|# #  |     |#####################| ##| ## |##################|####################| #### |##################|#####|##################|##################|##################|##############################################|"
Endif

Return

/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932Transp≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime linhas de transporte                               ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932Transp(lTotal)

Local nTamTransp := Len(LivrArrayObs(nLargObs,aTotMes))+Max(Len(aGrade),3)+2
lTotal :=If(lTotal==Nil,.F.,lTotal)
If lTotal
	nTamTransp*=2
EndIf
nMaior:=0
AEval(aTamNotas,{|x|nMaior:=Max(nMaior,x)})
aTamNotas[2]:=nMaior

nLinNec:=aTamNotas[2]
lTransp := nLimPag<=nLin+nTamTransp

If lTransp
	nTamTransp:=nLin
	If nTipoMov==1

		aObs:=LivrArrayObs(nLargObs,aTotMes)

		R932IniGrade()

		aGrade[1,2]:=aTransp[ColF3("F3_BASEICM")]
		aGrade[1,3]:=aTransp[ColF3("F3_VALICM")]
		aGrade[2,2]:=aTransp[ColF3("F3_ISENICM")]
		aGrade[3,2]:=aTransp[ColF3("F3_OUTRICM")]
		IF cMV_ESTADO != "SP" .OR. lCat21
			aGrade[4,2]:=aTransp[ColF3("F3_BASEIPI")]
			aGrade[4,3]:=aTransp[ColF3("F3_VALIPI")]
			aGrade[5,2]:=aTransp[ColF3("F3_ISENIPI")]
			aGrade[6,2]:=aTransp[ColF3("F3_OUTRIPI")]
	    ENDIF
		aDados:=ARRAY(16)
		FmtLin(@aDados,aL[18],,,@nLin)
		aDados[6]:="A TRANSPORTAR"
		aDados[8]:=aTransp[ColF3("F3_VALCONT")]

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Linhas de detalhe              ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		R932ImpGrade()

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Para atender legislacao Fomentar de GO ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and.aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTransp[ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[15]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aTransp[ColF3("F3_TIPO")] == "D"
					aDados[15]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
				Else
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			EndIf
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIf nColuna ==2 .and. aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")] >0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTransp[ColF3("F3_BASERET")]
			aDados[15]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIf nColuna ==3 .and. aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTransp[ColF3("F3_BASERET")]
			If aTransp[ColF3("F3_TIPO")] == "D"
				aDados[15]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
			Else
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		Endif
		nLinNec:=nLin-nTamTransp
		aTamNotas[2]:=Max(aTamNotas[2],nLinNec)

		R932Filler()
		R932Cabec()
	Else
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aObs:=LivrArrayObs(nLargObs,aTransp)
		aDados:=ARRAY(14)
		FmtLin(@aDados,aL[20],,,@nLin)
		aDados[3]:="A TRANSPORTAR" //
		aDados[6]:=aTransp[ColF3("F3_VALCONT")]
		aDados[9]:=aTransp[ColF3("F3_BASEICM")]
		aDados[11]:=aTransp[ColF3("F3_VALICM")]
		aDados[12]:=aTransp[ColF3("F3_ISENICM")]
		aDados[13]:=aTransp[ColF3("F3_OUTRICM")]
		R932LoadObs()
		FmtLin(@aDados,aL[20],cPictVl,,@nLin)

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and. aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTransp[ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[11]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aTransp[ColF3("F3_TIPO")] == "D"
					aDados[11]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
				Else
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			EndIf
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Elseif nColuna==2 .and. aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTransp[ColF3("F3_BASERET")]
			aDados[11]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Elseif nColuna==3 .and. aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTransp[ColF3("F3_BASERET")]
			If aTransp[ColF3("F3_TIPO")] == "D"
				aDados[11]:=aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")]
			Else
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTransp[ColF3("F3_ICMSRET")]-aTransp[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Endif

		nLinNec:=nLin-nTamTransp
		aTamNotas[2]:=Max(aTamNotas[2],nLinNec)

		R932Filler()
		R932Cabec()
	Endif
Endif

Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932Totdia≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime total do dia                                       ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932TotDia
Local nX := 0
lTotDia:=(dDiaAnt!=dDia)

If lTotDia .And. !Empty(dDia)
	aTamNotas[3]:=Max(aTamNotas[3],nLinNec)
	nLinNec:=aTamNotas[3]
	If nLimPag<=nLin+((nLinNec+1)*2)
		R932Transp(.T.)
	Endif

	nTamTotDia:=nLin
	If nTipoMov==1

		aObs:=LivrArrayObs(nLargObs,aTotDia)

		R932IniGrade()

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Monta array com valores de ICMS        ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aGrade[1,2]:=aTotDia[ColF3("F3_BASEICM")]
		aGrade[1,3]:=aTotDia[ColF3("F3_VALICM")]
		aGrade[2,2]:=aTotDia[ColF3("F3_ISENICM")]
		aGrade[3,2]:=aTotDia[ColF3("F3_OUTRICM")]
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Monta array com valores de IPI         ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		IF cMV_ESTADO != "SP" .OR. lCat21
			aGrade[4,2]:=aTotDia[ColF3("F3_BASEIPI")]
			aGrade[4,3]:=aTotDia[ColF3("F3_VALIPI")]
			aGrade[5,2]:=aTotDia[ColF3("F3_ISENIPI")]
			aGrade[6,2]:=aTotDia[ColF3("F3_OUTRIPI")]
	    ENDIF
		aDados:=ARRAY(16)
		FmtLin(@aDados,aL[18],,,@nLin)
		aDados[6]:="TOTAL DO DIA "+StrZero(Day(dDiaAnt),2) //
		aDados[8]:=aTotDia[ColF3("F3_VALCONT")]

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Linhas de detalhe              ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		R932ImpGrade()

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Para atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and. aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTotDia[ColF3("F3_BASERET")]
			If nColuna == 1
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[15]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aTotDia[ColF3("F3_TIPO")] == "D"
					aDados[15]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
				Else
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIf nColuna ==2.and. aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTotDia[ColF3("F3_BASERET")]
			aDados[15]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIf nColuna ==3.and. aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTotDia[ColF3("F3_BASERET")]
			If aTotDia[ColF3("F3_TIPO")] == "D"
				aDados[15]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
			Else
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		Endif
		FmtLin(@aDados,aL[18],,,@nLin)
		nLinNec:=nLin-nTamTotDia
		aTamNotas[3]:=Max(aTamNotas[3],nLinNec)
	Else
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aObs:=LivrArrayObs(nLargObs,aTotDia)
		aDados:=ARRAY(14)
		FmtLin(@aDados,aL[20],,,@nLin)
		aDados[3]:="TOTAL DO DIA "+StrZero(Day(dDiaAnt),2) //
		aDados[6]:=aTotDia[ColF3("F3_VALCONT")]
		aDados[9]:=aTotDia[ColF3("F3_BASEICM")]
		aDados[11]:=aTotDia[ColF3("F3_VALICM")]
		aDados[12]:=aTotDia[ColF3("F3_ISENICM")]
		aDados[13]:=aTotDia[ColF3("F3_OUTRICM")]
		R932LoadObs()
		FmtLin(@aDados,aL[20],cPictVl,,@nLin)

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and. aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTotDia[ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[11]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aTotDia[ColF3("F3_TIPO")] == "D"
					aDados[11]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
				Else
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			Endif
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		ElseIf nColuna ==2 .and. aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTotDia[ColF3("F3_BASERET")]
			aDados[11]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		ElseIf nColuna ==3 .and. aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTotDia[ColF3("F3_BASERET")]
			If aTotDia[ColF3("F3_TIPO")] == "D"
				aDados[11]:=aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")]
			Else
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotDia[ColF3("F3_ICMSRET")]-aTotDia[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Endif
		FmtLin(@aDados,aL[20],,,@nLin)
		nLinNec:=nLin-nTamTotDia
		aTamNotas[3]:=Max(aTamNotas[3],nLinNec)
	Endif
Endif
If nLimPag<=nLin+nLinNec
	R932Transp()
Endif
If lTotDia
	For nX := 1 to Len(aTotDia)
	Do Case
		Case ValType(aTotDia[nX]) == "C"
			aTotDia[nX] := ""
		Case ValType(aTotDia[nX]) == "N"
			aTotDia[nX] := 0
		OtherWise
			aTotDia[nX] := Nil				
		End Case
	Next nX		
Endif   

Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932TotMes≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 18.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime total do Mes                                       ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932TotMes
Local xx 		:= 1
Local nPosicao 	:= 0    
Local nProcFil	:= mv_par31
Local cFilDe	:= mv_par32
Local cFilAte	:= mv_par33
Local aArea		:= GetArea()
Local aAreaSm0 	:= SM0->(GetArea())

//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥Verifica se o processamento e centralizado, imprimindo mais de uma filial≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If nProcFil <> 1
	cFilDe 	:= cFilAnt
	cFilAte	:= cFilAnt
Endif      

SM0->(dbSeek(cEmpAnt+cFilDe,.T.))

********************* CIAP **********************
If lEmiteCiap
	nPosicao :=Ascan((cArqTemp)->(dbstruct()),{ |x| ( "F3_VALICM" $ x[1] ) })
	if nTipoMov==1 .and. lTotMes
		If nLin>=nLimPag.and.lImpMes
			R932Transp()
		Endif

		dData := LastDay(MV_PAR01)
		SFA->(dbSetOrder(2))

        //⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
        //≥Imprime atraves das filiais selecionadas para o processamento≥
        //¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
        Do While !SM0->(Eof()) .And. SM0->M0_CODIGO+SM0->M0_CODFIL <= cEmpAnt+cFilAte

			cFilAnt	:= SM0->M0_CODFIL
		
			If SFA->(dbSeek(xFilial("SFA")+dTos( dData )))
				While SFA->(!EOF()) .and. SFA->FA_FILIAL == xFilial("SFA") .and. Dtos(SFA->FA_DATA)== dTos(ddata)
					If ( SFA->FA_TIPO == "1" ) .and. (SFA->FA_CREDIT =="1")
						cMensagem:=Trim("Credito de ICMS relativo a entrada de Bem do Ativo ")+If(lColCiap,PADL(Transform(SFA->FA_VALOR,"@E 9,999,999.99"),58),"")
						For xx:=1 to MlCount(cMensagem,nLargObs)
							AADD(aObs,{MemoLine(cMensagem,nLargObs,xx),.T.})
						Next xx
	
						SF9->(dbSeek(xFilial()+SFA->FA_CODIGO))
						R932IniGrade()
						aGrade[1,1]:="1"
						If !lColCiap
							aGrade[1,3]:=SFA->FA_VALOR
						Endif
						nCredAtivo  +=SFA->FA_VALOR
	
						aDados:=Array(18)		
						If nLin>=nLimPag
							R932Filler()
							R932Cabec()
						EndIf
						FmtLin(@aDados,aL[18],,,@nLin)
						aDados[10]	:= SF9->F9_CFOENT
						R932ImpGrade()
						nPosObs:=Ascan(aObs,{|x|x[2]})
						While nPosObs>0
							R932LoadObs()
							If nPosObs>0
								If nLin>=nLimPag
									R932Filler()
									R932Cabec()
								EndIf
								FmtLin(@aDados,aL[17],cPictVl,,@nLin)
							Endif
						Enddo
					EndIf				
					SFA->(dBSkip())
				EndDo
			Endif	
			SM0->(dbSkip())
		Enddo
		aTotMes[nPosicao] +=nCredAtivo
	EndIf
Endif
******************* CIAP FIM *********************
If lTotMes.and.lImpMes
	If nLin>=nLimPag.and.lImpMes
		R932Transp()
	Endif
	If nTipoMov==1

		aObs:=LivrArrayObs(nLargObs,aTotMes)

		R932IniGrade()

		aGrade[1,2]:=aTotMes[ColF3("F3_BASEICM")]
		aGrade[1,3]:=aTotMes[ColF3("F3_VALICM")]
		aGrade[2,2]:=aTotMes[ColF3("F3_ISENICM")]
		aGrade[3,2]:=aTotMes[ColF3("F3_OUTRICM")]
		IF cMV_ESTADO != "SP" .OR. lCat21
			aGrade[4,2]:=aTotMes[ColF3("F3_BASEIPI")]
			aGrade[4,3]:=aTotMes[ColF3("F3_VALIPI")]
			aGrade[5,2]:=aTotMes[ColF3("F3_ISENIPI")]
			aGrade[6,2]:=aTotMes[ColF3("F3_OUTRIPI")]
	    ENDIF
		aDados:=ARRAY(16)
		FmtLin(@aDados,aL[18],,,@nLin)
		aDados[6]:="TOTAL DO MES"
		aDados[8]:=aTotMes[ColF3("F3_VALCONT")]

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Linhas de detalhe              ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		R932ImpGrade()

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Para atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and.aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTotMes[ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			ElseIf nColuna == 2
				aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aTotMes[ColF3("F3_TIPO")] == "D"
					aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
				Else
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIf nColuna == 2 .and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTotMes[ColF3("F3_BASERET")]
			aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIf nColuna == 3 .and.aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aTotMes[ColF3("F3_BASERET")]
			If aTotMes[ColF3("F3_TIPO")] == "D"
				aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
			Else
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		Endif
		FmtLin(@aDados,aL[18],,,@nLin)
	Else
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aObs:=LivrArrayObs(nLargObs,aTotMes)
		aDados:=ARRAY(14)
		FmtLin(@aDados,aL[20],,,@nLin)
		aDados[3]:="TOTAL DO MES"
		aDados[6]:=aTotMes[ColF3("F3_VALCONT")]
		aDados[9]:=aTotMes[ColF3("F3_BASEICM")]
		aDados[11]:=aTotMes[ColF3("F3_VALICM")]
		aDados[12]:=aTotMes[ColF3("F3_ISENICM")]
		aDados[13]:=aTotMes[ColF3("F3_OUTRICM")]
		R932LoadObs()
		FmtLin(@aDados,aL[20],cPictVl,,@nLin)

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Atender legislacao Fomentar de GO ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro).and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTotMes[ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			ElseIf nColuna == 2
				aDados[11]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aTotMes[ColF3("F3_TIPO")] == "D"
					aDados[11]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
				Else
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif			
			Endif
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Elseif nColuna ==2 .and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTotMes[ColF3("F3_BASERET")]
			aDados[11]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Elseif nColuna ==3 .and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aTotMes[ColF3("F3_BASERET")]
			If aTotMes[ColF3("F3_TIPO")] == "D"
				aDados[11]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
			Else
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif			
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Endif
		FmtLin(@aDados,aL[20],,,@nLin)
	Endif
	If !Eof()
		R932Filler()
	Endif
	
	For xx := 1 to Len(aTransp)
		If ValType(aTransp[xx]) == "N"
			aTransp[xx] := 0
		Else
			aTransp[xx] := "NULL"
		Endif
	Next

	For xx := 1 to Len(aTotMes)
		If ValType(aTotMes[xx]) == "N"
			aTotMes[xx] := 0
		Else
			aTotMes[xx] := "NULL"
		Endif
	Next

	For xx := 1 to Len(aTamNotas)
		If ValType(aTamNotas[xx]) == "N"
			aTamNotas[xx] := 0
		Else
			aTamNotas[xx] := "NULL"
		Endif
	Next
	
Endif    

//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥Restaura a filial e area corrente ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
RestArea(aAreaSm0)
cFilAnt	:= SM0->M0_CODFIL
RestArea(aArea)

Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932TotPer≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime total do periodo de apuracao                       ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932TotPer(nSvApurIcm,nSvApurIpi)
Local nCntFor	:=1
Local nX		:=0
nLinNec2:=0

If lTotPerICM
	aTamNotas[4]:=Max(aTamNotas[4],nLinNec)
	nLinNec2:=nLinNec2+aTamNotas[4]
Endif
If lTotPerIPI
	aTamNotas[5]:=Max(aTamNotas[5],nLinNec)
	nLinNec2:=nLinNec2+aTamNotas[5]
Endif

If lTotPerICM.or.lTotPerIPI
	nLinNec:=nLinNec2
	If nLimPag<=nLin+nLinNec
		R932Transp()
	Endif
	If nTipoMov==1

		aObs:={}

		R932IniGrade()

		If lTotPerICM
			aObs:=LivrArrayObs(nLargObs,aTotPerICM)
			aGrade[1,2]:=aTotPerICM[ColF3("F3_BASEICM")]
			aGrade[1,3]:=aTotPerICM[ColF3("F3_VALICM")]
			aGrade[2,2]:=aTotPerICM[ColF3("F3_ISENICM")]
			aGrade[3,2]:=aTotPerICM[ColF3("F3_OUTRICM")]
		Endif
		If lTotPerIPI
			IF cMV_ESTADO != "SP" .OR. lCat21
				aGrade[4,2]:=aTotPerIPI[ColF3("F3_BASEIPI")]
				aGrade[4,3]:=aTotPerIPI[ColF3("F3_VALIPI")]
				aGrade[5,2]:=aTotPerIPI[ColF3("F3_ISENIPI")]
				aGrade[6,2]:=aTotPerIPI[ColF3("F3_OUTRIPI")]
			ENDIF
		Endif
		aDados:=ARRAY(16)
		nTamTotPer:=nLin

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Linhas de detalhe              ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		cICM:="ICMS"
		cIPI:="IPI"
		nVlContICM:=aTotPerICM[ColF3("F3_VALCONT")]
		nVlContIPI:=aTotPerIPI[ColF3("F3_VALCONT")]

		lImprime:=.F.
		For nx:=1 to Len(aGrade)
			If !lImpZer.and.(aGrade[nx,2]+aGrade[nx,3])==0
				Loop
			Endif
			If nx<=3.and.!Empty(cICM)
				aDados[6]:="TOTAL DO PERIODO "
				aDados[8]:=nVlContICM
				aDados[11]:=cICM
				cICM:=NIL
				lImprime:=.T.
			Endif
			If nx>3.and.!Empty(cIPI)
				aDados[6]:="TOTAL DO PERIODO "
				aDados[8]:=nVlContIPI
				aDados[11]:=cIPI
				cIPI:=NIL
				lImprime:=.T.
			Endif
			aDados[12]:=aGrade[nx,1]
			aDados[13]:=aGrade[nx,2]
			aDados[15]:=If(aGrade[nx,3]>0,aGrade[nx,3],NIL)
			//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
			//≥ Coluna de Observacoes ≥
			//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
			If lImprime
				R932LoadObs()
				FmtLin(@aDados,If(!lTotGrade,aL[17],aL[18]),cPictVl,,@nLin)
			Endif
		Next nx

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0.and.lTotPerICM
			R932LoadObs()
			If nPosObs>0
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			Endif
		End

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Para atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If lTotPerICM
			If !Empty(cTitLivro) .and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
				aDados[11]:="ICMS"
				aDados[12]:="ST"
				aDados[13]:=aTotMes[ColF3("F3_BASERET")]
				If nColuna ==1
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				ElseIf nColuna == 2
					aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
				ElseIf nColuna == 3
					If aTotMes[ColF3("F3_TIPO")] == "D"
						aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
					Else
						aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
					Endif
				EndIf
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			ElseIf nColuna ==2 .and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
				aDados[11]:="ICMS"
				aDados[12]:="ST"
				aDados[13]:=aTotMes[ColF3("F3_BASERET")]
				aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			ElseIf nColuna ==3 .and. aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]>0
				aDados[11]:="ICMS"
				aDados[12]:="ST"
				aDados[13]:=aTotMes[ColF3("F3_BASERET")]
				If aTotMes[ColF3("F3_TIPO")] == "D"
					aDados[15]:=aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")]
				Else
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aTotMes[ColF3("F3_ICMSRET")]-aTotMes[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			Endif
		Endif
		If lTotPerICM
			nLinNec:=nLin-nTamTotPer
			aTamNotas[4]:=Max(aTamNotas[4],nLinNec)
		Endif
		If lTotPerIPI
			nLinNec:=nLin-nTamTotPer
			aTamNotas[5]:=Max(aTamNotas[5],nLinNec)
		Endif
		FmtLin(@aDados,aL[18],,,@nLin)
	Else
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If lTotPerIcm
			nTamTotPer:=nLin
			aObs:=LivrArrayObs(nLargObs,aTotPerICM)
			aDados:=ARRAY(14)
			aDados[3]:="TOTAL DO PERIODO"
			aDados[6]:=aTotPerICM[ColF3("F3_VALCONT")]
			aDados[9]:=aTotPerICM[ColF3("F3_BASEICM")]
			aDados[11]:=aTotPerICM[ColF3("F3_VALICM")]
			aDados[12]:=aTotPerICM[ColF3("F3_ISENICM")]
			aDados[13]:=aTotPerICM[ColF3("F3_OUTRICM")]

			R932LoadObs()
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)

			nPosObs:=Ascan(aObs,{|x|x[2]})
			While nPosObs>0
				R932LoadObs()
				If nPosObs>0
					FmtLin(@aDados,aL[20],cPictVl,,@nLin)
				Endif
			End
			//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
			//≥ Atender legislacao Fomentar de GO≥
			//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
			If !Empty(cTitLivro) .and. aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]>0
				aDados[8]:="ST"
				aDados[9]:=aTotPerICM[ColF3("F3_BASERET")]
				If nColuna ==1
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				ElseIf nColuna == 2
					aDados[11]:=aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]
				ElseIf nColuna == 3
					If aTotPerICM[ColF3("F3_TIPO")] == "D"
						aDados[11]:=aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]
					Else
						aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
					Endif
				EndIf
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			Elseif nColuna==2 .and. aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]>0
				aDados[8]:="ST"
				aDados[9]:=aTotPerICM[ColF3("F3_BASERET")]
				aDados[11]:=aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			Elseif nColuna==3 .and. aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]>0
				aDados[8]:="ST"
				aDados[9]:=aTotPerICM[ColF3("F3_BASERET")]
				If aTotPerICM[ColF3("F3_TIPO")] == "D"
					aDados[11]:=aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")]
				Else
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aTotPerICM[ColF3("F3_ICMSRET")]-aTotPerICM[ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			EndIf
			FmtLin(@aDados,aL[20],,,@nLin)

			nLinNec:=nLin-nTamTotPer
			aTamNotas[4]:=Max(aTamNotas[4],nLinNec)
		Endif
	Endif
	If lTotPerICM.Or.!(Month(dDia)==Month(dDiaAnt))
		For nCntFor := 1 to Len(aTotPerICM)
			If ValType(aTransp[nCntFor]) == "N"
				aTotPerICM[nCntFor] := 0
			Else
				aTotPerICM[nCntFor] := "NULL"
			Endif
		Next
		nSvApurICM:=DefPeriodo(dDia,nApurICM)
	Endif
	If lTotPerIPI.Or.!(Month(dDia)==Month(dDiaAnt))
		For nCntFor := 1 to Len(aTotPerIPI)
			If ValType(aTotPerIPI[nCntFor]) == "N"
				aTotPerIPI[nCntFor] := 0
			Else
				aTotPerIPI[nCntFor] := "NULL"
			Endif
		Next
		nSvApurIPI:=DefPeriodo(dDia,nApurIPI)
	Endif
Endif
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932ResCfo≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Resumo por CFO                                             ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932ResCfo
Local i	:=0

If (Len(aResCFO)==0 .Or. !(lTotPerIcm .Or. lTotPerIPI)) .And. !Eof()
   If nLin<nLimPag
      R932Filler()
   Endif
   Return
Endif

//⁄ƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Ordena CFOs≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒŸ
aResCFO:=Asort(aResCFO,,,{|x,y|x[ColF3("F3_CFO")]<y[ColF3("F3_CFO")]})

aCFOS:={"1.00 ENTRADAS DO ESTADO",;
	"2.00 ENTRADAS DE FORA DO ESTADO",; 
	"3.00 ENTRADAS DO EXTERIOR",;
	"",;
	"5.00 SAIDAS PARA O ESTADO",;
	"6.00 SAIDAS PARA FORA DO ESTADO",;
	"7.00 SAIDAS PARA O EXTERIOR"}

cSvCFO:="X"
If nLin<nLimPag
	R932Filler()
Endif
nLin:=80
For i:=1 to Len(aResCFO)
	If nLin>nLimPag
		R932Cabec()
	EndIf
	aObs:=LivrArrayObs(nLargObs,aResCFO[i])
	cCFO:=Trim(aResCFO[i,ColF3("F3_CFO")])
	If nTipoMov==1

		If i==1
			FmtLin(@aDados,aL[18],,,@nLin)
			aDados[6]:="RESUMO DAS OPERACOES E PRESTACOES POR CODIGO FISCAL"
			FmtLin(@aDados,aL[18],,,@nLin)
			aDados[6]:="==================================================="
			FmtLin(@aDados,aL[18],,,@nLin)
		EndIf

		R932IniGrade()

		aGrade[1,2]:=aResCFO[i,ColF3("F3_BASEICM")]
		aGrade[1,3]:=aResCFO[i,ColF3("F3_VALICM")]
		aGrade[1,4]:=aResCFO[i,ColF3("F3_VALCONT")]
		aGrade[2,2]:=aResCFO[i,ColF3("F3_ISENICM")]
		aGrade[3,2]:=aResCFO[i,ColF3("F3_OUTRICM")]
		IF cMV_ESTADO != "SP" .OR. lCat21
			aGrade[4,2]:=aResCFO[i,ColF3("F3_BASEIPI")]
			aGrade[4,3]:=aResCFO[i,ColF3("F3_VALIPI")]
			aGrade[5,2]:=aResCFO[i,ColF3("F3_ISENIPI")]
			aGrade[6,2]:=aResCFO[i,ColF3("F3_OUTRIPI")]
		ENDIF
		aDados:=ARRAY(16)
		If !(Substr(cCFO,1,1)==cSvCFO).and.!(ALLTRIM(cCFO)$"TTT") .And. !Empty (cCfo)
			If (nLin+3)>nLimPag
				R932Filler()
				R932Cabec()
			EndIf
			FmtLin(@aDados,aL[18],,,@nLin)
			cSvCFO:=Substr(cCFO,1,1)
			aDados[6]:=If(cSvCFO="0",,aCFOS[Val(cSvCFO)])			
			FmtLin(@aDados,aL[18],,,@nLin)
			aDados[6]:=Replic("=",If(cSvCFO="0",3,Len(aCFOS[Val(cSvCFO)])))			
			FmtLin(@aDados,aL[18],,,@nLin)
		Endif
		If ("TT"$cCFO)
			If (nLin+1)>nLimPag
				R932Filler()
				R932Cabec()
			EndIf
			FmtLin(@aDados,aL[18],,,@nLin)
			aDados[6]:=If(ALLTRIM(cCFO)=="TTT","TOTAL","SUB-TOTAL") //###
		Else
			aDados[10]:=TransForm(cCFO,PESQPICT("SF3","F3_CFO"))
		Endif
		aDados[8]:=aResCFO[i,ColF3("F3_VALCONT")]

		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Imprime Linhas de detalhe              ≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		R932ImpGrade()

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				If (nLin+1)>nLimPag
					R932Filler()
					R932Cabec()
				EndIf
				FmtLin(@aDados,aL[18],cPictVl,,@nLin)
			Endif
		End
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Para atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro) .and. aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aResCFO[i,ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[15]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aResCFO[i,ColF3("F3_TIPO")] == "D"
					aDados[15]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
				Else
					aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
				Endif
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIF nColuna ==2 .and. aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aResCFO[i,ColF3("F3_BASERET")]
			aDados[15]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		ElseIF nColuna ==3 .and. aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]>0
			aDados[11]:="ICMS"
			aDados[12]:="ST"
			aDados[13]:=aResCFO[i,ColF3("F3_BASERET")]
			If aResCFO[i,ColF3("F3_TIPO")] == "D"
				aDados[15]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
			Else
				aDados[16]:="ICMS RETIDO: "+Alltrim(Transform(aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			Endif
			FmtLin(@aDados,aL[18],cPictVl,,@nLin)
		Endif
	Else
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥Controla a impressao de CFO's de Saida.≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If Val(Substr(cCFO,1,1))<5 .AND. !(ALLTRIM(cCFO)=="TTT")
			Loop
		Endif
		If i==1
			If mv_par27 == 1 .And. nTotIcmDeb > 0
				FmtLin(@aDados,aL[20],,,@nLin)
				aDados[14]:= "ICMS A SER DEBITADO: "+Transform(nTotIcmDeb,PESQPICT("SF3","F3_ICMSRET")) //
				FmtLin(@aDados,aL[20],,,@nLin)
			Endif
			
			FmtLin(@aDados,aL[20],,,@nLin)
			aDados[3]:="RESUMO DAS OPERACOES E PRESTACOES POR CODIGO FISCAL"
			FmtLin(@aDados,aL[20],,,@nLin)
			aDados[3]:="==================================================="
			FmtLin(@aDados,aL[20],,,@nLin)
		EndIf
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Cria Array com mensagens a serem impressas na coluna de Observacao≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		aDados:=ARRAY(14)

		If !(Substr(cCFO,1,1)==cSvCFO).and.!(ALLTRIM(cCFO)=="TTT")
			If (nLin+3)>nLimPag
				R932Filler()
				R932Cabec()
			EndIf
			FmtLin(@aDados,aL[20],,,@nLin)
			cSvCFO:=Substr(cCFO,1,1)
			aDados[3]:=If(cSvCFO="0",,aCFOS[Val(cSvCFO)])			
			FmtLin(@aDados,aL[20],,,@nLin)
			aDados[3]:=Replic("=",If(cSvCFO="0",3,Len(aCFOS[Val(cSvCFO)])))
			FmtLin(@aDados,aL[20],,,@nLin)
		Endif
		If ("TT"$cCFO)
			If (nLin+1)>nLimPag
				R932Filler()
				R932Cabec()
			EndIf
			FmtLin(@aDados,aL[20],,,@nLin)
			aDados[3]:=If(ALLTRIM(cCFO)=="TTT","TOTAL","SUB-TOTAL") //###
		Else
			aDados[8]:=TransForm(cCFO,PESQPICT("SF3","F3_CFO"))
		Endif
		aDados[6]:=aResCFO[i,ColF3("F3_VALCONT")]
		aDados[9]:=aResCFO[i,ColF3("F3_BASEICM")]
		aDados[11]:=aResCFO[i,ColF3("F3_VALICM")]
		aDados[12]:=aResCFO[i,ColF3("F3_ISENICM")]
		aDados[13]:=aResCFO[i,ColF3("F3_OUTRICM")]
		R932LoadObs()
		If (nLin+1)>nLimPag
			R932Filler()
			R932Cabec()
		EndIf
		FmtLin(@aDados,aL[20],cPictVl,,@nLin)

		nPosObs:=Ascan(aObs,{|x|x[2]})
		While nPosObs>0
			R932LoadObs()
			If nPosObs>0
				If (nLin+1)>nLimPag
					R932Filler()
					R932Cabec()
				EndIf
				FmtLin(@aDados,aL[20],cPictVl,,@nLin)
			Endif
		End
		If (nLin+1)>nLimPag
			R932Filler()
			R932Cabec()
		EndIf
		//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
		//≥ Atender legislacao Fomentar de GO≥
		//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
		If !Empty(cTitLivro) .and. aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aResCFO[i,ColF3("F3_BASERET")]
			If nColuna ==1
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //
			ElseIf nColuna == 2
				aDados[11]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
			ElseIf nColuna == 3
				If aResCFO[i,ColF3("F3_TIPO")] == "D"
					aDados[11]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
				Else
					aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
				Endif
			Endif
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Elseif nColuna ==2 .and. aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aResCFO[i,ColF3("F3_BASERET")]
			aDados[11]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Elseif nColuna ==3 .and. aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]>0
			aDados[8]:="ST"
			aDados[9]:=aResCFO[i,ColF3("F3_BASERET")]
			If aResCFO[i,ColF3("F3_TIPO")] == "D"
				aDados[11]:=aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")]
			Else
				aDados[14]:="ICMS RETIDO: "+Alltrim(Transform(aResCFO[i,ColF3("F3_ICMSRET")]-aResCFO[i,ColF3("F3_OBSSOL")],PESQPICT("SF3","F3_ICMSRET"))) //"ICMS RETIDO: "
			Endif
			FmtLin(@aDados,aL[20],cPictVl,,@nLin)
		Endif
	Endif
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Completa preenchimento da folha ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	If i==Len(aResCFO)
		If nTipoMov==1
			FmtLin(@aDados,aL[18],,,@nLin)
		Else
			FmtLin(@aDados,aL[20],,,@nLin)
		Endif
		aResCfo:={}
		R932Filler()
	ElseIf nLin+nLinNec>nLimPag
		R932Filler()
	Endif
Next i

Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥ R932ResEst≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Resumo por Estado                                          ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932ResEst

Local lFirstCO:=.T.
Local lFirstNC:=.T.
Local nTotvlrctb:=0
Local nTotvlrbsc:=0
Local nTotimpdeb	:=0
Local nTotisenta	:=0
Local nTotoutras	:=0
Local nTotIcmCre	:=0
Local nTotIPICre	:=0
Local nTotBasIPI	:=0
Local i				:=0
Local j				:=0

If (Len(aResumo)==0 .Or. !(lTotPerIcm .Or. lTotPerIPI)) .And. !Eof()
   Return
Endif

nLin:=80
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Arranja o resumo em ordem de CFO e Estado≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
aResumo:=ASort(aResumo,,,{|x,y|x[1]+x[2]<y[1]+y[2]})
For i:=1 to Len(aResumo)
	If nLin>nLimPag
   		If nLin<>80
   			FmtLin({},aL[01],,,@nLin)
   		EndIf
		R932Cabec()
	Endif
	If nTipoMov==1
	   aDados:=ARRAY(17)
	   //⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	   //≥Verifica se deve listar ou nao o estado origem no resumo≥
	   //¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	   If (lLisEstOri.Or.(!lLisEstOri.And.cMV_Estado!=aResumo[i,2]))
		  If i==1
			 FmtLin(@aDados,aL[17],,,@nLin)
			 aDados[8]:="DEMONSTRATIVO POR ESTADO DE ORIGEM DA MERCADORIA OU DE INICIO DA PRESTACAO DE SERVICO"
			 FmtLin(@aDados,aL[17],,,@nLin)
			 aDados[8]:="====================================================================================="
			 FmtLin(@aDados,aL[17],,,@nLin)
			 FmtLin(@aDados,aL[17],,,@nLin)
		  Endif
		  aGrade:={}
          
          If mv_par26 == 1
 		     If aResumo[i,4]>0 //Base de Calculo
			    AADD(aGrade,{"1",aResumo[i,4]})
			 Endif
			 If aResumo[i,7]>0 .And. lLisIsenta //ICMS Isentas
			    AADD(aGrade,{"2",aResumo[i,7]})
			 Endif			
			 If aResumo[i,5]>0 //ICMS Outras
			    AADD(aGrade,{"3",aResumo[i,5]})
			 Endif
			 aDados[7]:=aResumo[i,2]  // Estado
			 aDados[8]:=aResumo[i,3]  //Valor Contabil
			 aDados[11]:="ICMS"

             If aResumo[i,8]>0          		//Valor Icms
			    aDados[15] :=aResumo[i,8]
             EndIf
             
             If nModelo == 1
                If aResumo[i,9]>0 				// Base de Calculo IPI
				   aDados[16] :=aResumo[i,9]
			    Endif
			 Endif   
		  Else
 		     If aResumo[i,4]>0 //Base de Calculo
			    AADD(aGrade,{"1",aResumo[i,4]})
			 Endif
			 If aResumo[i,7]>0 .And. lLisIsenta //ICMS Isentas
			    AADD(aGrade,{"2",aResumo[i,7]})
			 Endif			
			 If aResumo[i,5]>0 //ICMS Outras
			    AADD(aGrade,{"3",aResumo[i,5]})
			 Endif
			 aDados[7]:=aResumo[i,2]  // Estado
			 aDados[8]:=aResumo[i,3]  //Valor Contabil
			 aDados[11]:="ICMS"
		  Endif
			   
		  If aResumo[i,6]>0 .and. nColuna ==1  //ICMS Retido
			 aDados[16]:="Icms Retido "+Alltrim(Transform(aResumo[i,6],PESQPICT("SF3","F3_ICMSRET")))
		  Endif         
			
		  //⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒXø
          //≥criar totalizador de resumo por estado. quando o parametro  mv_par24 for sim ≥
          //¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒXŸ

		  If MV_PAR25 == 1                
     		 nTotvlrctb:= nTotvlrctb + aResumo[i,3] //Valor Contabil
     		 
		     If aResumo[i,4]>0 //Base de Calculo
			 	nTotvlrbsc +=	aResumo[i,4]
		   	 Endif
             If aResumo[i,7]>0 .And. lLisIsenta //ICMS Isentas
                  nTotvlrbsc +=	aResumo[i,7]
             EndIf
             If aResumo[i,5]>0 //ICMS Outras
			 	 nTotvlrbsc +=	aResumo[i,5]
		     Endif
	    	 If mv_par26 == 1
			    nTotIcmCre	+=aResumo[i,08] //Total Icm Creditado
			    nTotIPICre	+=aResumo[i,10] //Total Ipi Creditado
			    nTotBasIPI	+=aResumo[i,09] //Base de Calculo IPI
	    	 Endif
	 	  Endif 
		  
		  if Len(aGrade)>0
			 For j:=1 to Len(aGrade)
				 aDados[12]:=aGrade[j,1]
				 aDados[13]:=aGrade[j,2]
				 FmtLin(@aDados,aL[17],cPictVl,,@nLin)
			 Next j
		  Else
			 FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		  EndIf	
		  If aResumo[i,13]>0 .and. nColuna ==1   //ICMS NORMAL
			  aDados[16]:="ICMS NORMAL"+Alltrim(Transform(aResumo[i,13],PESQPICT("SF3","F3_OBSICM")))
			  FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		  Endif			
		  If aResumo[i,14]>0 .and. nColuna ==1   //ICMS ST. INT.
			  aDados[16]:="ICMS ST. INT."+Alltrim(Transform(aResumo[i,14],PESQPICT("SF3","F3_OBSSOL")))
			  FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		  EndIf	
		  If aResumo[i,15]>0 .and. nColuna ==1   //CRED. PRES. ST
			aDados[16]:="CRED. PRES. ST "+Alltrim (Transform (aResumo[i,15], PESQPICT("SF3","F3_CRPRST")))
			FmtLin(@aDados,aL[17],cPictVl,,@nLin)
		  Endif
	   Endif
	Else
	   aDados:=ARRAY(14)
	   //⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	   //≥Verifica se deve listar ou nao o estado origem no resumo≥
	   //¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	   If (lLisEstOri.Or.(!lLisEstOri.And.cMV_Estado!=aResumo[i,2]))
		  If i==1
			 FmtLin(@aDados,aL[19],,,@nLin)
			 aDados[7]:="DEMONSTRATIVO POR ESTADO DE DESTINO DA MERCADORIA OU DA PRESTACAO DE SERVICO"
			 FmtLin(@aDados,aL[19],,,@nLin)
			 aDados[7]:="============================================================================"
			 FmtLin(@aDados,aL[19],,,@nLin)
			 FmtLin(@aDados,aL[19],,,@nLin)
		  Endif
		  If lFirstCO.and.aResumo[i,1]=="CO"
			 lFirstCO:=.F.
			 aDados[9]:="OPERACOES REALIZADAS COM CONTRIBUINTES"
			 FmtLin(@aDados,aL[19],,,@nLin)
			 aDados[9]:="======================================"
			 FmtLin(@aDados,aL[19],,,@nLin)
		  Endif
		  If lFirstNC.and.aResumo[i,1]=="NC"
			 lFirstNC:=.F.
			 aDados[9]:="OPERACOES REALIZADAS COM NAO CONTRIBUINTES"
			 FmtLin(@aDados,aL[19],,,@nLin)
			 aDados[9]:="=========================================="
			 FmtLin(@aDados,aL[19],,,@nLin)
		  Endif
		  If mv_par26 == 1
		     aDados[05]:=aResumo[i,2]
		     aDados[06]:=aResumo[i,3]
		     aDados[09]:=aResumo[i,4]            
		     aDados[11]:=aResumo[i,8]
		     aDados[12]:=aResumo[i,7]
		     aDados[13]:=aResumo[i,5]            
		  Else
		     aDados[5]:=aResumo[i,2]
		     aDados[6]:=aResumo[i,3]
			 aDados[9]:=aResumo[i,4]            
		  Endif   

		  If aResumo[i,6]>0 .and. nColuna ==1
		     aDados[14]:="Icms Retido "+Alltrim(Transform(aResumo[i,6],PESQPICT("SF3","F3_ICMSRET"))	)
		  Endif
			
          If mv_par25 == 1                
   	 	     nTotvlrctb +=aResumo[i,3] //Valor Contabil
	         nTotvlrbsc +=aResumo[i,4] //Base de Calculo
             If mv_par26 == 1
   	 	        nTotimpdeb +=aResumo[i,8] //Imposto Debitado
	            nTotisenta +=aResumo[i,7] //Coluna Isentas
   	 	        nTotoutras +=aResumo[i,5] //Coluna Outras
   	 	     Endif   
     	  Endif 
			FmtLin(@aDados,aL[19],cPictVl,,@nLin)
		Endif
		If aResumo[i,13]>0 .and. nColuna ==1   //ICMS NORMAL
			aDados[14]:="ICMS NORMAL "+Alltrim(Transform(aResumo[i,13],PESQPICT("SF3","F3_OBSICM")))
			FmtLin(@aDados,aL[19],cPictVl,,@nLin)
		Endif			
		If aResumo[i,14]>0 .and. nColuna ==1   //ICMS ST. INT.
		    aDados[14]:="ICMS ST. INT."+Alltrim(Transform(aResumo[i,14],PESQPICT("SF3","F3_OBSSOL")))
		    FmtLin(@aDados,aL[19],cPictVl,,@nLin)
	   Endif
	Endif
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Completa preenchimento da folha ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	If i==Len(aResumo)

	   IF nTipoMov == 2  .AND. MV_PAR25 == 1
          aDados[03]:="TOTAL"
          aDados[06]:=nTotvlrctb		//TOTAL Valor Contabil
          aDados[09]:=nTotvlrbsc		//TOTAL Base de Calculo
          If mv_par26 == 1
	         aDados[11]:=nTotimpdeb		//Imposto Debitado
		     aDados[12]:=nTotisenta		//Coluna Isentas
			 aDados[13]:=nTotoutras		//Coluna Outras
		  Endif   
          FmtLin(@aDados,aL[19],cPictVl,,@nLin)
       ELSE 
          IF nTipoMov==1 .AND. MV_PAR25 == 1
             aDados[5]		:="TOTAL"
             aDados[8]		:=	 nTotvlrctb //TOTAL Valor Contabil
             aDados[13]	:=	 nTotvlrbsc //TOTAL Base de Calculo
         	 If mv_par26 == 1
	   	        aDados[15]	:= nTotIcmCre
	   	     	If nModelo == 1
		     	   aDados[16]	:= nTotIPICre
		     	Endif   
		   	 Endif   

             FmtLin(@aDados,aL[17],cPictVl,,@nLin)
          ENDIF
       ENDIF                    
	   R932Filler()
	Endif
Next i
aResumo:={}
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932LoadObs≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Carrega observacao para ser impressa                       ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932LoadObs

nPosObs:=Ascan(aObs,{|x|x[2]})
If nPosObs>0
	aDados[If(nTipoMov==1,16,14)]:=aObs[nPosObs,1]
	aObs[nPosObs,2]:=.F.
Endif

Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932Totais ≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Aciona funcoes de totalizacao                              ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932Totais(nSvApurIcm,nSvApurIpi)
R932Transp()
If lTotalDia
	R932TotDia()
Endif

lTotPerICM:=(nSvApurICM!=DefPeriodo(dDia,nApurICM)) .Or. IIf(nApurIcm==3,Month(dDia)!=Month(dDiaAnt),.F.)
lTotPerIPI:=(nSvApurIPI!=DefPeriodo(dDia,nApurIPI)) .Or. IIf(nApurIpi==3,Month(dDia)!=Month(dDiaAnt),.F.)
lTotMes:=(Month(dDiaAnt)!=Month(dDia))

R932TotPer(@nSvApurIcm,@nSvApurIpi)
R932TotMes()
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Termino do Relatorio≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If lTotMes
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Imprime Resumo por CFO ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932ResCfo()
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Imprime Resumo por Estado ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932ResEst()
Endif                   

//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Imprime Termo de Encerramento≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
R932TermEnc()
Return

/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932TermIni≥Autor ≥ Rodrigo de A. Sartorio≥ Data ≥ 25.03.98 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime termo de abertura no caso de so listar termos      ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932TermIni()
nPagina:=1
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Imprime Termos de Abertura/Encerramento≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
aPagTerm:=CtrlPg(@nPagina,nQtFeixe,lReiniPg)
cPagina :=Transform(StrZero(nPagina,6),"@R 999.999")
If (nImpTerm == 2 .Or. nImpTerm == 3).and.aPagTerm[1]+aPagTerm[2]>0
	If nTipoMov==1
		ImprimeTermo(aPagTerm[1],nPagIni,nQtFeixe,GetMv("MV_LENTEN"),nLargMax,cPerg)
		nPagIni:=ImprimeTermo(aPagTerm[2],nPagIni,nQtFeixe,GetMv("MV_LENTAB"),nLargMax,cPerg)
	Else
		ImprimeTermo(aPagTerm[1],nPagIni,nQtFeixe,GetMv("MV_LSAIEN"),nLargMax,cPerg)
		nPagIni:=ImprimeTermo(aPagTerm[2],nPagIni,nQtFeixe,GetMv("MV_LSAIAB"),nLargMax,cPerg)
	Endif
Endif
Return

/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932TermEnc≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime termo de encerramento no fim do relatorio          ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932TermEnc
If ((Eof().Or.!lHouveMov).and. nImpTerm == 3) .Or. (nImpTerm == 2)
	If nTipoMov==1
		ImprimeTermo(nPagina,nPagIni,nQtFeixe,GetMv("MV_LENTEN"),nLargMax,cPerg)
	Else
		ImprimeTermo(nPagina,nPagIni,nQtFeixe,GetMv("MV_LSAIEN"),nLargMax,cPerg)
	Endif
Endif
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932Filler ≥Autor ≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Preenche folha com linha vazias                            ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932Filler
IF nLin<67
    While nLin<=nLimPag
	    FmtLin(@aDados,If(nTipoMov==1,aL[17],aL[19]),,,@nLin)
    End                       
    If nLin>=nLimPag
        FmtLin(@aDados,aL[1],,,@nLin)
    ENdif   
ENDIF
Return
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932IniGrade≥Autor≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Inicializa array aGrade do registro de entradas            ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932IniGrade
//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Monta grade de impressao            ≥
//≥ [1]=Codigo de Operacao de ICMS/IPI  ≥
//≥ [2]=Base de Calculo/Isentas/ Outras ≥
//≥ [3]=Valor do ICMS / IPI             ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
IF cMV_ESTADO == "SP" .And. !lCat21
	aGrade:={{"1",0,0,0},{"2",0,0,0},{"3",0,0,0}}   	// ICMS
ELSE
	aGrade:={{"1",0,0,0},{"2",0,0,0},{"3",0,0,0},;   	// ICMS
			{"1",0,0,0},{"2",0,0,0},{"3",0,0,0}}	  	// IPI
ENDIF
Return
/*
‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹‹
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±⁄ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒø±±
±±≥FunáÖo    ≥R932ImpGrade≥Autor≥ Juan Jose Pereira     ≥ Data ≥ 23.12.96 ≥±±
±±√ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¥±±
±±≥DescriáÖo ≥ Imprime aGrade do registro de entradas                     ≥±±
±±¿ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂﬂ
*/
STATIC FUNCTION R932ImpGrade
Local lImprimiu :=.F.
Local nX		:=0
cICMS:="ICMS"
cIPI :="IPI"
For nx:=1 to Len(aGrade)
	If !lImpZer.and.((aGrade[nx,2]+aGrade[nx,3]+aGrade[nx,4])==0 .Or. (aGrade[nx,2]+aGrade[nx,3]+aGrade[nx,4])==aGrade[nx,4])
		Loop
	Endif
	lImprimiu:=.T.
	If nx<=3
		aDados[11]:=cICMS
		cICMS:=NIL
	Else
		aDados[11]:=cIPI
		cIPI:=NIL
	Endif
	aDados[12]:=aGrade[nx,1]
	aDados[13]:=aGrade[nx,2]
	aDados[15]:=If(aGrade[nx,3]>0,aGrade[nx,3],NIL)
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Coluna de Observacoes ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932LoadObs()
	FmtLin(@aDados,If(!lTotGrade,aL[17],aL[18]),cPictVl,,@nLin)
Next nx

//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
//≥ Imprime itens com lancamento no livro fiscal zerado   ≥
//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
If !lImprimiu .And. !Empty(aDados[1]) .And. F3_VALCONT>0
	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Coluna de ICMS        ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	aDados[11]:=cICMS
	cICMS:=NIL

	aDados[12]:="1"
	aDados[13]:=0
	aDados[15]:=0

	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Coluna de Observacoes ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932LoadObs()
	FmtLin(@aDados,If(!lTotGrade,aL[17],aL[18]),cPictVl,,@nLin)

	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Coluna de IPI         ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	aDados[11]:=cIPI
	cIPI:=NIL

	aDados[12]:="1"
	aDados[13]:=0
	aDados[15]:=0

	//⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
	//≥ Coluna de Observacoes ≥
	//¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
	R932LoadObs()
	FmtLin(@aDados,If(!lTotGrade,aL[17],aL[18]),cPictVl,,@nLin)
Endif

Return
